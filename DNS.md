ДНС распределённой системой, имеет множество узлов, каждый из которых ответственен за свою зону. структура ДНС иерархической, выделяет зоны ответственности, где каждый родитель знает о расположении своего дочернего сервера, и знает зону его ответственности.

<img width="960" height="461" alt="image" src="https://github.com/user-attachments/assets/901376d5-78fa-4d50-9bdc-b25dd12bd12a" />

компонентами ДНС:

Домен (доменное имя) — символьное имя для обозначения сервера в интернете. Доменные имена являются иерархической структурой, в которой каждый уровень отделяется точкой. Основными уровнями являются:

Корневой домен. В урле он не используется, но всегда подразумевается. От него начинается построение всех урлов в интернете
Домены верхнего уровня. К ним относятся .ru, .com, .net, .su и так далее. Также его называют доменом первого уровня.
Домен второго уровня (или основной). Это основное имя вашего сайта
Поддомены (третьего, четвёртого, пятого и т.д. уровня). Сюда входят все поддомены основного домена.
DNS-сервер — система, ответственная за хранение и поддержание в актуальном состоянии записей о своих дочерних доменах. Каждый сервер ответственен только за свою зону, ДНС-сервер домена .io знает о том, где расположен домен hexlet, ДНС-сервер которого знает о расположении своих поддоменов.

Корневой DNS-сервер — система, знающая расположение (IP-адреса) ДНС-серверов доменов верхнего уровня.

Ресурсная запись — единица информации ДНС-сервера. Каждая ресурсная запись имеет несколько полей:

Имя (домен, к которому относится запись)
Тип
Параметры
Значение
Подключение

доменное имя — абстракция для людей. компьютер и приложения (браузер) обращается к сервисам внутри сети интернет по IP-адресам.

процесс получения IP-адреса по доменному имени на примере домена ru.hexlet.io.

Компьютер посылает запрос на известный ему DNS-сервер. Чаще всего им является ДНС-сервер поставщика интернет-услуг (провайдера): какой IP-адрес у домена ru.hexlet.io?. DNS-сервер провайдера находит в своей базе информацию о том, что домен ru.hexlet.io расположен по IP-адресу 104.25.238.104 и возвращает значение нашему компьютеру. Этот процесс похож на то, как использовался файл hosts.txt.

Ближайший известный DNS-сервер не имеет записи о том, по какому IP-адресу располагается домен ru.hexlet.io. запускается цепочка процессов, благодаря которым наш компьютер получит IP-адрес домена:

домен является иерархической структурой, и все DNS-сервера знают IP-адреса корневых DNS-серверов, к ним и происходит запрос на получение IP-адреса домена.
Корневые DNS-сервера, в соответствии со своей зоной ответственности знают о том, где располагаются DNS-сервера доменов верхнего уровня. Эти адреса возвращаются DNS-серверу нашего провайдера, после чего на нужный DNS-сервер (в нашем случае на DNS-сервер домена .io) посылается запрос на получение IP-адреса домена ru.hexlet.
В соответствии со своей зоной ответственности DNS-сервер домена верхнего уровня возвращает IP-адрес DNS-сервера домена hexlet, на который посылается запрос на получение IP-адреса поддомена ru.
DNS-сервер возвращает IP-адреса поддомена ru, после чего DNS-сервер нашего провайдера возвращает полученный адрес на наш компьютер, который уже может обратиться к домену ru.hexlet.io по его IP-адресу.
Рекурсия в DNS
оба описанных выше варианта сильно различаются: в первом случае послали запрос и получили ответ, а во втором — идти от самого корневого домена в процессе поиска нужной нам записи. процесс рекурсивным, ближайший DNS-сервер непрерывно посылает запросы к другим DNS-серверам до тех пор, пока не получит необходимые ресурсные записи.

<img width="960" height="461" alt="image" src="https://github.com/user-attachments/assets/08b112dc-ed9f-410c-89ec-c4810f68364b" />

При запросах 1 и 2 ближайший сервер получать информацию о местонахождении DNS-серверов, которые входят в зону ответственности того сервера, на который был послан запрос. При запросе 3 получены ресурсные записи домена hexlet и его поддоменов.

Рекурсивный поиск — долгая операция, нагружает сеть и сами DNS-сервера. избавиться от рекурсии каждый DNS-сервер кеширует информацию о записях, которые получает, для быстрой отдачи этой информации пользователю.

рекурсивный поиск предполагает нахождение конечного ответа на наш запрос путём поиска записи по всем необходимым DNS-серверам, начиная с корневого. итеративный запрос, в отличие от рекурсивного выполняет одну итерацию — запрос ближайшему DNS-серверу, от которого получить как закешированный ответ, данные той зоны, за которую он ответственен. итеративный запрос предполагает всего один такой запрос.

в интернете DNS-сервера умеют посылать рекурсивные запросы, ответ можно закешировать, снизить нагрузку как на сам сервер, и на другие сервера. Время, на которое DNS-сервер кеширует информацию, указывается в ресурсной записи ДНС.
интернет подразумевает не только получение IP-адреса по доменному имени, но и пересылку электронной почты, подключение доп сервисов аналитики к сайту, настройку защищённого протокола HTTPS. ресурсных записей ДНС.
A-запись — одна из самых важных записей. запись на IP-адрес сервера, который привязан к доменному имени.
MX-запись — указывает на сервер, который будет использован при отсылке доменной электронной почты.
NS-запись — указывает на DNS-сервер домена.
CNAME-запись — позволяет одному из поддоменов дублировать DNS-записи своего родителя. перенаправить запрос с одного домена на другой (чаще всего для перенаправления домена с поддоменом www на домен без такого поддомена).
TXT-запись — в этой записи хранится текстовая информация о домене. для подтверждения прав на владение, посредством добавления определённой строки, которую присылает нам интернет-сервис.

Ресурсные записи одинаковые, но для некоторых записей появляться другие поля, в MX-записях присутствует значение приоритета. ресурсные записи имеют структуру:

Имя записи TTL Класс Тип записи Значение

Имя записи — указывается домен, которому принадлежит данная ресурсная запись.

TTL (time to live / время жизни) — время в секундах, на которое закешировано значение ресурсной записи. разгрузки DNS-серверов. Благодаря кешированию и возможна ситуация, что ближайший DNS-сервер знает IP-адрес запрашиваемого домена.
Класс — DNS может работать не только в интернете, поэтому в записи указывается и её класс. На сегодняшний день поддерживается только одно значение — IN (Internet).
Тип — указывает тип ресурсной записи, основные из которых были разобраны выше.
Значение — значение ресурсной записи. В зависимости от типа ресурсной записи значения могут быть представлены в разном виде.
в каком виде эти записи хранятся на DNS-серверах на примере домена ya.ru. утилитой dig, получает все доступные ресурсные DNS-записи от DNS-сервера и выводит их пользователю.
Утилита dig является DNS-клиентом и входит в состав одного из самых распространённых DNS-серверов BIND.
Пример реальных записей DNS

<img width="1526" height="833" alt="image" src="https://github.com/user-attachments/assets/eba402e9-6709-4d92-a362-9ef22fbf6b5f" />

Шапка
Секция запроса
Секция ответа
Служебная информация
Шапка запроса

; <<>> Net::DNS::Dig 0.12 <<>> -t any ya.ru. ;; ;; Got answer. ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 52109 ;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 0
Здесь указывается проставленные флаги нашего запроса, количество запросов и ответов, а также другая служебная информация.

Секция запроса
;; QUESTION SECTION: ;ya.ru. IN ANY
В секции запроса домен, к которому происходит обращение, класс записи и те записи, которые мы хотим получить. ANY указывает на то, что вывести все доступные ресурсные записи, но если вы хотите поэкспериментировать с утилитой сами, то можете с помощью ключа получить вывод только конкретных записей, которые интересуют в настоящий момент.

Секция ответа большая, поэтому для удобства разобьём её по типам ресурсных записей.

;; ANSWER SECTION: ya.ru. 7199 IN NS ns1.yandex.ru. ya.ru. 7199 IN NS ns2.yandex.ru. ya.ru. 599 IN A 87.250.250.242 ya.ru. 599 IN AAAA 2A02:6B8:0:0:0:0:2:242
Как запись A, так и AAAA-запись указывают на IP-адрес, который привязан к нашему домену. A-запись указывает IP в формате IPv4, а запись AAAA — в формате IPv6.

ya.ru. 7199 IN MX 10 mx.yandex.ru.
MX-запись также имеет параметр приоритета. Так как серверов для отправки почты может быть несколько, то и записей может быть много, поэтому для определения основного сервера указывается приоритет записи. Чем меньше число, тем выше приоритет.

ya.ru. 3599 IN SOA ns1.yandex.ru. sysadmin.yandex.ru. 2019021800 900 600 2592000 900
Запись SOA (Start of Authority) указывает на несколько различных параметров:
Сервер с эталонной информацией о текущем домене
Контактную информацию ответственного лица
Различные параметры кеширования записей
специфичные ресурсные записи. перечень записей найти в документации (по DNS-серверу BIND).

DNS-сервера основу интернета и используются почти в каждом действии, переход на сайт, отправка электронной почты, работы с интернет-приложением на телефоне. ресурсные записи, благодаря которым возможно перемещение по интернету.
